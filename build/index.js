!function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,r,t){Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=15)}([function(e,r){e.exports=require("fs-extra")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("@reactivex/rxjs")},function(e,r){"use strict";var t=function(){function e(){}return e.routeNotFound=function(e,r){r.error.notFound()},e.policyError=function(e,r){r.error.policyFailed()},e}();r.ErrorHandler=t},function(e,r,t){"use strict";var n=t(2),o=function(){function e(e){this.policies$=n.Observable.from(e)}return e.prototype.evaluate=function(e){return this.policies$.filter(function(r){return e.route.policies.indexOf(r.name)!==-1||0===e.route.policies.length}).map(function(r){return r.method(e.reqres)})["do"](function(e){return console.log(e)}).reduce(function(e,r){var t=r?0:1;return e+t},0).map(function(r){return 0===r?Object.assign({route:e.route,reqres:e.reqres,pass:!0}):Object.assign({route:e.route,reqres:e.reqres,pass:!1})})},e}();r.PolicyEvaluator=o},function(e,r,t){"use strict";var n=t(2),o=t(18),s=function(){function e(e){this.request=e,this.verb=this.request.method}return e.extract=function(e){if("GET"===e.method.toUpperCase()){var r=e;return r.params=this.getParams(e),r}if("POST"===e.method.toUpperCase()){var r=e;return r.body=this.getJSON(e),r}},e.getJSON=function(e){return n.Observable.fromEvent(e,"data").buffer(n.Observable.fromEvent(e,"end")).map(function(e){return JSON.parse(e.toString())})},e.getParams=function(e){var r=e.url,t=o.parse(r,!0).query;return t},e}();r.RequestExtractor=s},function(e,r){"use strict";var t=function(){function e(e){var r=this;this.response=e,this.response.json=function(e){r.response.writeHead(200,{"Content-Type":"application/json"}),r.response.end(JSON.stringify(e))},this.response.ok=function(e){void 0===e&&(e="Success"),r.response.writeHead(200,{"Content-Type":"application/json"}),r.response.end(JSON.stringify({success:!0,message:e}))},this.response.unauthorized=function(e){void 0===e&&(e="You are not authorized to access this resource."),r.response.writeHead(401,{"Content-Type":"application/json"}),r.response.end(JSON.stringify({success:!1,message:e}))},this.response.error={generic:function(e,t){void 0===e&&(e=404),void 0===t&&(t="Resource not found"),r.response.writeHead(e,{"Content-Type":"application/json"}),r.response.end(JSON.stringify({success:!1,message:t}))},server:function(){r.response.writeHead(500,{"Content-Type":"application/json"}),r.response.end(JSON.stringify({success:!1,message:"Something went wrong on the server. Please try again later."}))},notFound:function(){r.response.writeHead(404,{"Content-Type":"application/json"}),r.response.end(JSON.stringify({success:!1,message:"Resource Not Found"}))},policyFailed:function(){r.response.writeHead(401,{"Content-Type":"application/json"}),r.response.end(JSON.stringify({success:!1,message:"One or more policies prevented access to this route."}))}}}return e.prototype.load=function(){return this.response},e}();r.ResponseLoader=t},function(e,r,t){"use strict";var n=t(2),o=t(3),s=function(){function e(e){this.routes$=n.Observable.from(e)}return e.prototype.match=function(e){var r=this;return this.routes$.map(function(t){return r.parseUrls(t,e)}).filter(function(e){var r="undefined"!=typeof e.reqres.req&&e.route.path===e.reqres.req.unparsedUrl&&e.route.verb.toUpperCase()===e.reqres.req.method.toUpperCase();return r}).defaultIfEmpty(Object.assign({},{reqres:e,route:{path:"/route-not-found",verb:"GET",policies:[],handler:o.ErrorHandler.routeNotFound}}))},e.prototype.parseUrls=function(e,r){var t=e.path,n=r.req.url,o=t.match(/(:[^\/|\s]+)/g),s=t.match(/(^\/[a-zA-Z-_\/]*)/g)[0];o=null===o?[]:o;var i,u=n.replace(s,"").split("/"),c=u.filter(function(e){return e.length>1}),a=s.length>1?s.concat("/").concat(c.join("/")):s.concat(c.join("/"));if(o.length>0&&o.length===c.length){var p=o.map(function(e,r){return e+"="+c[r]}).map(function(e){return e.slice(1,e.length)}),f=s.concat("?").concat(p.join("&")),l={handler:e.handler,policies:e.policies,verb:e.verb,path:a},d=Object.assign(r.req,{url:f,unparsedUrl:n});i={route:l,reqres:Object.assign(r,{req:d})}}else i={route:e,reqres:{req:Object.assign({},r.req,{unparsedUrl:n}),res:r.res}};return i},e}();r.Router=s},function(e,r,t){"use strict";var n=t(2),o=t(16),s=t(17),i=function(){function e(e){void 0===e&&(e="http"),this.protocol=e}return e.prototype.server=function(e,r){var t=this;return void 0===r&&(r=this.protocol),n.Observable.create(function(n){var o="http"===r?t.getHttpServer(n):t.getHttpsServer(n);return o.listen(e),function(){n.complete(),o.close()}})},e.prototype.getHttpServer=function(e){var r=o.createServer(function(r,t){e.next({req:r,res:t})});return r},e.prototype.getHttpsServer=function(e){var r=s.createServer(function(r,t){e.next({req:r,res:t})});return r},e}();r.Server=i},function(e,r){"use strict";var t=function(){function e(){}return e.handle=function(e){var r=(e.exec||"undefined"==typeof e.exec)&&e.pass;r&&e.route.handler(e.req,e.res)},e}();r.RequestHandler=t},function(e,r,t){"use strict";function n(e){var r=u.resolve(e);i(r).then(function(e){return s(e)}).then(function(e){return o(r,e)}).then(function(){console.log("Done!")})["catch"](function(e){return console.log(e)})}function o(e,r){return new Promise(function(t,n){var o=u.join(e,"index.ts");c.writeFile(o,r,function(e){e&&n(e),t()})})}function s(e){return new Promise(function(r,t){var n=e.filter(function(e){return e.indexOf("index")===-1}).map(function(e){return e.slice(0,e.length-3)}).map(function(e){return"import { policies as "+e+" } from './"+e+"';\r\n"}).reduce(function(e,r){return e.concat(r)},"import { Policy } from '../src/policy';\r\n"),o=e.filter(function(e){return e.indexOf("index")===-1}).map(function(e){return e.slice(0,e.length-3)}),s="export const policies: Policy[] = [].concat(..."+o.toString()+")",i=n.concat("\r\n").concat(s);r(i)})}function i(e){return new Promise(function(r,t){c.readdir(e,function(e,n){e&&t(e),r(n)})})}var u=t(1),c=t(0);r.exportPolicies=n},function(e,r,t){"use strict";function n(e){var r=u.resolve(e);i(r).then(function(e){return s(e)}).then(function(e){return o(r,e)}).then(function(){console.log("Done!")})["catch"](function(e){return console.log(e)})}function o(e,r){return new Promise(function(t,n){var o=u.join(e,"index.ts");c.writeFile(o,r,function(e){e&&n(e),t()})})}function s(e){return new Promise(function(r,t){var n=e.filter(function(e){return e.indexOf("index")===-1}).map(function(e){return e.slice(0,e.length-3)}).map(function(e){return"import { routes as "+e+" } from './"+e+"';\r\n"}).reduce(function(e,r){return e.concat(r)},"import { Route } from '../src/router';\r\n"),o=e.filter(function(e){return e.indexOf("index")===-1}).map(function(e){return e.slice(0,e.length-3)}),s="export const routes: Route[] = [].concat(..."+o.toString()+")",i=n.concat("\r\n").concat(s);r(i)})}function i(e){return new Promise(function(r,t){c.readdir(e,function(e,n){e&&t(e),r(n)})})}var u=t(1),c=t(0);r.exportRoutes=n},function(e,r,t){"use strict";var n=t(10);r.exportPolicies=n.exportPolicies;var o=t(11);r.exportRoutes=o.exportRoutes},function(e,r,t){"use strict";var n=t(3);r.ErrorHandler=n.ErrorHandler},function(e,r){e.exports=require("mime")},function(e,r,t){"use strict";function n(e,r,t,n,d,v,h,m,q){void 0===q&&(q="assets");var g=new o.Server,y=new s.Router(r),x=new i.PolicyEvaluator(t);return g.server(e).map(function(e){var r=e.res;return null!==d&&"undefined"!=typeof d&&"array"==typeof d?r.setHeader("Access-Control-Allow-Origin",d.join(",")):null!==d&&"undefined"!=typeof d&&"string"==typeof d&&r.setHeader("Access-Control-Allow-Origin",d),null!==n&&"undefined"!=typeof n&&r.setHeader("Access-Control-Allow-Methods",n.join(",")),null!==v&&"undefined"!=typeof v&&r.setHeader("Access-Control-Allow-Headers",v.join(",")),"OPTIONS"===e.req.method&&(e.res.writeHead(200),e.res.end()),null!==h&&"undefined"!=typeof h&&h.forEach(function(e){r.setHeader(e.key,e.value)}),r.sendFile=function(r,t,n){var o=f.createReadStream(r);e.res.setHeader("Content-Type",t),null!==n&&"undefined"!=typeof n&&e.res.setHeader("Content-Length",""+n),e.res.writeHead(200),o.pipe(e.res)},null!==m&&"undefined"!=typeof m?r.render=function(e,r){m(e,r)}:r.render=function(e){r.writeHead(200,{"Content-Type":"text/html"}),r.end(e)},{req:e.req,res:r}}).map(function(e){var r="^/"+q+"/?[^s]+",t=e.req.url.match(r),n=null!==t;if(n){var o=l.lookup(e.req.url),s=p.join(process.cwd(),e.req.url),i=f.statSync(s);return e.res.sendFile(s,o,i.size),{req:e.req,res:e.res,pass:!1}}return e}).map(function(e){var r={req:"GET"!==e.req.method.toUpperCase()?c.RequestExtractor.extract(e.req):e.req,res:e.res,pass:e.pass};return r}).map(function(e){return y.match(e)})["switch"]().map(function(e){var r=new u.ResponseLoader(e.reqres.res),t=r.load(),n="GET"===e.reqres.req.method.toUpperCase()?c.RequestExtractor.extract(e.reqres.req):e.reqres.req,o={route:e.route,reqres:{req:n,res:t,pass:e.reqres.pass}};return o}).map(function(e){return x.evaluate(e)})["switch"]().map(function(e){var r={pass:e.pass,exec:e.reqres.pass,req:e.reqres.req,res:e.reqres.res,route:e.route};return r}).map(function(e){return console.log(e.exec,e.pass),e.pass||!e.exec&&"undefined"!=typeof e.exec?e:(a.ErrorHandler.policyError(e.req,e.res),e)})}var o=t(8),s=t(7),i=t(4),u=t(6),c=t(5),a=t(3),p=t(1),f=t(0),l=t(14);r.createServer=n;var d=t(8);r.Server=d.Server;var v=t(12);r.exportPolicies=v.exportPolicies,r.exportRoutes=v.exportRoutes;var h=t(13);r.ErrorHandler=h.ErrorHandler;var m=t(5);r.RequestExtractor=m.RequestExtractor;var q=t(6);r.ResponseLoader=q.ResponseLoader;var g=t(9);r.RequestHandler=g.RequestHandler;var y=t(7);r.Router=y.Router;var x=t(4);r.PolicyEvaluator=x.PolicyEvaluator},function(e,r){e.exports=require("http")},function(e,r){e.exports=require("https")},function(e,r){e.exports=require("url")}]);